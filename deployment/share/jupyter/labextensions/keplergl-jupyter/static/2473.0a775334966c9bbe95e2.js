"use strict";(self.webpackChunkkeplergl_jupyter=self.webpackChunkkeplergl_jupyter||[]).push([[2473],{44572:(t,e,s)=>{s.d(e,{H:()=>a});class a{schema;length=0;allocated=0;columns={};constructor(t,e){this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let e=0;for(const s in this.columns)this.columns[s][this.length]=t[e++];this.length++}addObjectRow(t){this._reallocateColumns();for(const e in t)this.columns[e][this.length]=t[e];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const e in this.schema){const s=this.schema[e];t[s.name]=this.columns[s.index]}return this.columns={},{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:100,this.columns={};for(const t in this.schema){const e=this.schema[t],s=e.type||Float32Array,a=this.columns[e.index];if(a&&ArrayBuffer.isView(a)){const t=new s(this.allocated);t.set(a),this.columns[e.index]=t}else a?(a.length=this.allocated,this.columns[e.index]=a):this.columns[e.index]=new s(this.allocated)}}}_pruneColumns(){for(const[t,e]of Object.entries(this.columns))this.columns[t]=e.slice(0,this.length)}}},5709:(t,e,s)=>{s.d(e,{Y:()=>i});class a{schema;options;shape;length=0;rows=null;cursor=0;_headers=[];constructor(t,e){if(this.options=e,this.schema=t,!Array.isArray(t)){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}rowCount(){return this.length}addArrayRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="array-row-table",this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}addObjectRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.shape="object-row-table",this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;return t?(t=t.slice(0,this.length),this.rows=null,{shape:this.shape||"array-row-table",batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}var r=s(6004);class o{schema;options;length=0;objectRows=null;arrayRows=null;cursor=0;_headers=null;constructor(t,e){if(this.options=e,this.schema=t,t){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}rowCount(){return this.length}addArrayRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||=(0,r.kV)(t),this.options.shape){case"object-row-table":const s=(0,r.QY)(t,this._headers);this.addObjectRow(s,e);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(100),this.arrayRows[this.length]=t,this.length++}}addObjectRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this._headers||=(0,r.oj)(t),this.options.shape){case"array-row-table":const s=(0,r.aZ)(t,this._headers);this.addArrayRow(s,e);break;case"object-row-table":this.objectRows=this.objectRows||new Array(100),this.objectRows[this.length]=t,this.length++}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}var n=s(44572);const h={shape:void 0,batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0};class i{schema;options;aggregator=null;batchCount=0;bytesUsed=0;isChunkComplete=!1;lastBatchEmittedMs=Date.now();totalLength=0;totalBytes=0;rowBytes=0;static ArrowBatch;constructor(t,e){this.schema=t,this.options={...h,...e}}limitReached(){return!!(Boolean(this.options?.limit)&&this.totalLength>=this.options.limit)||!!(Boolean(this.options?._limitMB)&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),"string"==typeof t&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?8*t.length:8*Object.keys(t).length}_isFull(){if(!this.aggregator||0===this.aggregator.rowCount())return!1;if("auto"===this.options.batchSize){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return!(this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs||(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),0))}_getBatch(t){if(!this.aggregator)return null;t?.bytesUsed&&(this.bytesUsed=t.bytesUsed);const e=this.aggregator.getBatch();return e.count=this.batchCount,e.bytesUsed=this.bytesUsed,Object.assign(e,t),this.batchCount++,this.aggregator=null,e}_getTableBatchType(){switch(this.options.shape){case"array-row-table":case"object-row-table":return o;case"columnar-table":return n.H;case"arrow-table":if(!i.ArrowBatch)throw new Error("TableBatchBuilder");return i.ArrowBatch;default:return a}}}},6004:(t,e,s)=>{function a(t,e){if(!t)throw new Error("null row");const s={};if(e)for(let a=0;a<e.length;a++)s[e[a]]=t[a];else for(let e=0;e<t.length;e++)s[`column-${e}`]=t[e];return s}function r(t,e){if(!t)throw new Error("null row");if(e){const s=new Array(e.length);for(let a=0;a<e.length;a++)s[a]=t[e[a]];return s}return Object.values(t)}function o(t){const e=[];for(let s=0;s<t.length;s++){const t=`column-${s}`;e.push(t)}return e}function n(t){return Object.keys(t)}s.d(e,{QY:()=>a,aZ:()=>r,kV:()=>o,oj:()=>n})},21829:(t,e,s)=>{function a(t){switch("object"==typeof t&&t?.shape){case"array-row-table":case"object-row-table":return Array.isArray(t.data);case"geojson-table":return Array.isArray(t.features);case"columnar-table":return t.data&&"object"==typeof t.data;case"arrow-table":return Boolean(void 0!==t?.data?.numRows);default:return!1}}function r(t){switch(t.shape){case"array-row-table":case"object-row-table":return t.data.length;case"geojson-table":return t.features.length;case"arrow-table":return t.data.numRows;case"columnar-table":for(const e of Object.values(t.data))return e.length||0;return 0;default:throw new Error("table")}}function o(t){if(t.schema)return t.schema.fields.length;if(0===r(t))throw new Error("empty table");switch(t.shape){case"array-row-table":return t.data[0].length;case"object-row-table":return Object.keys(t.data[0]).length;case"geojson-table":return Object.keys(t.features[0]).length;case"columnar-table":return Object.keys(t.data).length;case"arrow-table":return t.data.numCols;default:throw new Error("table")}}function n(t,e,s){switch(t.shape){case"array-row-table":const a=function(t,e){const s=t.schema?.fields.findIndex((t=>t.name===e));if(void 0===s)throw new Error(e);return s}(t,s);return t.data[e][a];case"object-row-table":return t.data[e][s];case"geojson-table":return t.features[e][s];case"columnar-table":return t.data[s][e];case"arrow-table":const r=t.data,o=r.schema.fields.findIndex((t=>t.name===s));return r.getChildAt(o)?.get(e);default:throw new Error("todo")}}function h(t,e,s,a){switch(t.shape){case"object-row-table":return a?Object.fromEntries(Object.entries(t.data[e])):t.data[e];case"array-row-table":if(t.schema){const a=s||{};for(let s=0;s<t.schema.fields.length;s++)a[t.schema.fields[s].name]=t.data[e][s];return a}throw new Error("no schema");case"geojson-table":if(t.schema){const a=s||{};for(let s=0;s<t.schema.fields.length;s++)a[t.schema.fields[s].name]=t.features[e][s];return a}throw new Error("no schema");case"columnar-table":if(t.schema){const a=s||{};for(let s=0;s<t.schema.fields.length;s++)a[t.schema.fields[s].name]=t.data[t.schema.fields[s].name][e];return a}{const a=s||{};for(const[s,r]of Object.entries(t.data))a[s]=r[e];return a}case"arrow-table":const r=t.data,o=s||{},n=r.get(e),h=r.schema;for(let t=0;t<h.fields.length;t++)o[h.fields[t].name]=n?.[h.fields[t].name];return o;default:throw new Error("shape")}}function i(t,e,s,a){switch(t.shape){case"array-row-table":return a?Array.from(t.data[e]):t.data[e];case"object-row-table":if(t.schema){const a=s||[];for(let s=0;s<t.schema.fields.length;s++)a[s]=t.data[e][t.schema.fields[s].name];return a}return Object.values(t.data[e]);case"geojson-table":if(t.schema){const a=s||[];for(let s=0;s<t.schema.fields.length;s++)a[s]=t.features[e][t.schema.fields[s].name];return a}return Object.values(t.features[e]);case"columnar-table":if(t.schema){const a=s||[];for(let s=0;s<t.schema.fields.length;s++)a[s]=t.data[t.schema.fields[s].name][e];return a}{const a=s||[];let r=0;for(const s of Object.values(t.data))a[r]=s[e],r++;return a}case"arrow-table":const r=t.data,o=s||[],n=r.get(e),h=r.schema;for(let t=0;t<h.fields.length;t++)o[t]=n?.[h.fields[t].name];return o;default:throw new Error("shape")}}function*l(t,e){switch(e){case"array-row-table":yield*c(t);break;case"object-row-table":yield*function*(t,e={}){const s=r(t);for(let a=0;a<s;a++)yield h(t,a,e)}(t);break;default:throw new Error(`Unknown row type ${e}`)}}function*c(t,e=[]){const s=r(t);for(let a=0;a<s;a++)yield i(t,a,e)}s.d(e,{a5:()=>c,bI:()=>a,fD:()=>n,gt:()=>h,pg:()=>r,q0:()=>i,r2:()=>l,wH:()=>o})}}]);