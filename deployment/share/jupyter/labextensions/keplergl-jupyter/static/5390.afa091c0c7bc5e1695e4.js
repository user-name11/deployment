/*! For license information please see 5390.afa091c0c7bc5e1695e4.js.LICENSE.txt */
"use strict";(self.webpackChunkkeplergl_jupyter=self.webpackChunkkeplergl_jupyter||[]).push([[5390],{85390:(e,t,r)=>{r.r(t),r.d(t,{CSVLoader:()=>_,CSVWriter:()=>A});var n=r(6004);class i extends Array{enqueue(e){return this.push(e)}dequeue(){return this.shift()}}class s{_values;_settlers;_closed;constructor(){this._values=new i,this._settlers=new i,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[Symbol.asyncIterator](){return this}enqueue(e){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const t=this._settlers.dequeue();e instanceof Error?t.reject(e):t.resolve({value:e})}else this._values.enqueue(e)}next(){if(this._values.length>0){const e=this._values.dequeue();return e instanceof Error?Promise.reject(e):Promise.resolve({value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise(((e,t)=>{this._settlers.enqueue({resolve:e,reject:t})}))}}var a=r(5709);const o={parse:function(e,t,r){var n=(t=t||{}).dynamicTyping||!1;if(m(n)&&(t.dynamicTypingFunction=n,n={}),t.dynamicTyping=n,t.transform=!!m(t.transform)&&t.transform,t.worker&&o.WORKERS_SUPPORTED){var i=newWorker();return i.userStep=t.step,i.userChunk=t.chunk,i.userComplete=t.complete,i.userError=t.error,t.step=m(t.step),t.chunk=m(t.chunk),t.complete=m(t.complete),t.error=m(t.error),delete t.worker,void i.postMessage({input:e,config:t,workerId:i.id})}var s=null;return"string"==typeof e&&(s=new h(t)),s||(s=new r(t)),s.stream(e)},unparse:function(e,t){var r=!1,n=!0,i=",",s="\r\n",a='"',u=a+a,l=!1,h=null;!function(){if("object"==typeof t){if("string"!=typeof t.delimiter||o.BAD_DELIMITERS.filter((function(e){return-1!==t.delimiter.indexOf(e)})).length||(i=t.delimiter),("boolean"==typeof t.quotes||Array.isArray(t.quotes))&&(r=t.quotes),"boolean"!=typeof t.skipEmptyLines&&"string"!=typeof t.skipEmptyLines||(l=t.skipEmptyLines),"string"==typeof t.newline&&(s=t.newline),"string"==typeof t.quoteChar&&(a=t.quoteChar),"boolean"==typeof t.header&&(n=t.header),Array.isArray(t.columns)){if(0===t.columns.length)throw new Error("Option columns is empty");h=t.columns}void 0!==t.escapeChar&&(u=t.escapeChar+a)}}();var d=new RegExp(c(a),"g");if("string"==typeof e&&(e=JSON.parse(e)),Array.isArray(e)){if(!e.length||Array.isArray(e[0]))return p(null,e,l);if("object"==typeof e[0])return p(h||f(e[0]),e,l)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),Array.isArray(e.data)&&(e.fields||(e.fields=e.meta&&e.meta.fields),e.fields||(e.fields=Array.isArray(e.data[0])?e.fields:f(e.data[0])),Array.isArray(e.data[0])||"object"==typeof e.data[0]||(e.data=[e.data])),p(e.fields||[],e.data||[],l);throw new Error("Unable to serialize unrecognized input");function f(e){if("object"!=typeof e)return[];var t=[];for(var r in e)t.push(r);return t}function p(e,t,r){var a="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var o=Array.isArray(e)&&e.length>0,u=!Array.isArray(t[0]);if(o&&n){for(var l=0;l<e.length;l++)l>0&&(a+=i),a+=m(e[l],l);t.length>0&&(a+=s)}for(var h=0;h<t.length;h++){var d=o?e.length:t[h].length,c=!1,f=o?0===Object.keys(t[h]).length:0===t[h].length;if(r&&!o&&(c="greedy"===r?""===t[h].join("").trim():1===t[h].length&&0===t[h][0].length),"greedy"===r&&o){for(var p=[],g=0;g<d;g++){var y=u?e[g]:g;p.push(t[h][y])}c=""===p.join("").trim()}if(!c){for(var v=0;v<d;v++){v>0&&!f&&(a+=i);var _=o&&u?e[v]:v;a+=m(t[h][_],v)}h<t.length-1&&(!r||d>0&&!f)&&(a+=s)}}return a}function m(e,t){if(null==e)return"";if(e.constructor===Date)return JSON.stringify(e).slice(1,25);e=e.toString().replace(d,u);var n="boolean"==typeof r&&r||Array.isArray(r)&&r[t]||function(e,t){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>-1)return!0;return!1}(e,o.BAD_DELIMITERS)||e.indexOf(i)>-1||" "===e.charAt(0)||" "===e.charAt(e.length-1);return n?a+e+a:e}},RECORD_SEP:String.fromCharCode(30),UNIT_SEP:String.fromCharCode(31),BYTE_ORDER_MARK:"\ufeff",BAD_DELIMITERS:["\r","\n",'"',"\ufeff"],WORKERS_SUPPORTED:!1,NODE_STREAM_INPUT:1,LocalChunkSize:10485760,RemoteChunkSize:5242880,DefaultDelimiter:",",Parser:f,ParserHandle:d,ChunkStreamer:l,StringStreamer:h},u=o;function l(e){this._handle=null,this._finished=!1,this._completed=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},function(e){var t=p(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new d(t),this._handle.streamer=this,this._config=t}.call(this,e),this.parseChunk=function(e,t){if(this.isFirstChunk&&m(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(e);void 0!==r&&(e=r)}this.isFirstChunk=!1;var n=this._partialLine+e;this._partialLine="";var i=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var s=i.meta.cursor;this._finished||(this._partialLine=n.substring(s-this._baseIndex),this._baseIndex=s),i&&i.data&&(this._rowCount+=i.data.length);var a=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(m(this._config.chunk)&&!t){if(this._config.chunk(i,this._handle),this._handle.paused()||this._handle.aborted())return;i=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),this._completed||!a||!m(this._config.complete)||i&&i.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),a||i&&i.meta.paused||this._nextChunk(),i}},this._sendError=function(e){m(this._config.error)&&this._config.error(e)}}function h(e){var t;e=e||{},l.call(this,e),this.stream=function(e){return t=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e=this._config.chunkSize,r=e?t.substr(0,e):t;return t=e?t.substr(e):"",this._finished=!t,this.parseChunk(r)}}}function d(e){var t,r,n,i=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,s=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,a=this,u=0,l=0,h=!1,d=!1,g=[],y={data:[],errors:[],meta:{}};if(m(e.step)){var v=e.step;e.step=function(t){if(y=t,w())b();else{if(b(),!y.data||0===y.data.length)return;u+=t.data.length,e.preview&&u>e.preview?r.abort():v(y,a)}}}function _(t){return"greedy"===e.skipEmptyLines?""===t.join("").trim():1===t.length&&0===t[0].length}function b(){if(y&&n&&(x("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+o.DefaultDelimiter+"'"),n=!1),e.skipEmptyLines)for(var t=0;t<y.data.length;t++)_(y.data[t])&&y.data.splice(t--,1);return w()&&function(){if(y)if(Array.isArray(y.data[0])){for(var t=0;w()&&t<y.data.length;t++)y.data[t].forEach(r);y.data.splice(0,1)}else y.data.forEach(r);function r(t){m(e.transformHeader)&&(t=e.transformHeader(t)),g.push(t)}}(),function(){if(!y||!y.data||!e.header&&!e.dynamicTyping&&!e.transform)return y;function t(t,r){var n,i=e.header?{}:[];for(n=0;n<t.length;n++){var s=n,a=t[n];e.header&&(s=n>=g.length?"__parsed_extra":g[n]),e.transform&&(a=e.transform(a,s)),a=k(s,a),"__parsed_extra"===s?(i[s]=i[s]||[],i[s].push(a)):i[s]=a}return e.header&&(n>g.length?x("FieldMismatch","TooManyFields","Too many fields: expected "+g.length+" fields but parsed "+n,l+r):n<g.length&&x("FieldMismatch","TooFewFields","Too few fields: expected "+g.length+" fields but parsed "+n,l+r)),i}var r=1;return!y.data[0]||Array.isArray(y.data[0])?(y.data=y.data.map(t),r=y.data.length):y.data=t(y.data,0),e.header&&y.meta&&(y.meta.fields=g),l+=r,y}()}function w(){return e.header&&0===g.length}function k(t,r){return function(t){return e.dynamicTypingFunction&&void 0===e.dynamicTyping[t]&&(e.dynamicTyping[t]=e.dynamicTypingFunction(t)),!0===(e.dynamicTyping[t]||e.dynamicTyping)}(t)?"true"===r||"TRUE"===r||"false"!==r&&"FALSE"!==r&&(i.test(r)?parseFloat(r):s.test(r)?new Date(r):""===r?null:r):r}function x(e,t,r,n){y.errors.push({type:e,code:t,message:r,row:n})}this.parse=function(i,s,a){var u=e.quoteChar||'"';if(e.newline||(e.newline=function(e,t){e=e.substr(0,1048576);var r=new RegExp(c(t)+"([^]*?)"+c(t),"gm"),n=(e=e.replace(r,"")).split("\r"),i=e.split("\n"),s=i.length>1&&i[0].length<n[0].length;if(1===n.length||s)return"\n";for(var a=0,o=0;o<n.length;o++)"\n"===n[o][0]&&a++;return a>=n.length/2?"\r\n":"\r"}(i,u)),n=!1,e.delimiter)m(e.delimiter)&&(e.delimiter=e.delimiter(i),y.meta.delimiter=e.delimiter);else{var l=function(t,r,n,i,s){var a,u,l;s=s||[",","\t","|",";",o.RECORD_SEP,o.UNIT_SEP];for(var h=0;h<s.length;h++){var d=s[h],c=0,p=0,m=0;l=void 0;for(var g=new f({comments:i,delimiter:d,newline:r,preview:10}).parse(t),y=0;y<g.data.length;y++)if(n&&_(g.data[y]))m++;else{var v=g.data[y].length;p+=v,void 0!==l?v>1&&(c+=Math.abs(v-l),l=v):l=0}g.data.length>0&&(p/=g.data.length-m),(void 0===u||c>u)&&p>1.99&&(u=c,a=d)}return e.delimiter=a,{successful:!!a,bestDelimiter:a}}(i,e.newline,e.skipEmptyLines,e.comments,e.delimitersToGuess);l.successful?e.delimiter=l.bestDelimiter:(n=!0,e.delimiter=o.DefaultDelimiter),y.meta.delimiter=e.delimiter}var d=p(e);return e.preview&&e.header&&d.preview++,t=i,r=new f(d),y=r.parse(t,s,a),b(),h?{meta:{paused:!0}}:y||{meta:{paused:!1}}},this.paused=function(){return h},this.pause=function(){h=!0,r.abort(),t=t.substr(r.getCharIndex())},this.resume=function(){h=!1,a.streamer.parseChunk(t,!0)},this.aborted=function(){return d},this.abort=function(){d=!0,r.abort(),y.meta.aborted=!0,m(e.complete)&&e.complete(y),t=""}}function c(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function f(e){var t,r=(e=e||{}).delimiter,n=e.newline,i=e.comments,s=e.step,a=e.preview,u=e.fastMode,l=t=void 0===e.quoteChar?'"':e.quoteChar;if(void 0!==e.escapeChar&&(l=e.escapeChar),("string"!=typeof r||o.BAD_DELIMITERS.indexOf(r)>-1)&&(r=","),i===r)throw new Error("Comment character same as delimiter");!0===i?i="#":("string"!=typeof i||o.BAD_DELIMITERS.indexOf(i)>-1)&&(i=!1),"\n"!==n&&"\r"!==n&&"\r\n"!==n&&(n="\n");var h=0,d=!1;this.parse=function(e,o,f){if("string"!=typeof e)throw new Error("Input must be a string");var p=e.length,g=r.length,y=n.length,v=i.length,_=m(s);h=0;var b=[],w=[],k=[],x=0;if(!e)return F();if(u||!1!==u&&-1===e.indexOf(t)){for(var E=e.split(n),S=0;S<E.length;S++){if(k=E[S],h+=k.length,S!==E.length-1)h+=n.length;else if(f)return F();if(!i||k.substr(0,v)!==i){if(_){if(b=[],I(k.split(r)),P(),d)return F()}else I(k.split(r));if(a&&S>=a)return b=b.slice(0,a),F(!0)}}return F()}for(var C,T=e.indexOf(r,h),A=e.indexOf(n,h),D=new RegExp(c(l)+c(t),"g");;)if(e[h]!==t)if(i&&0===k.length&&e.substr(h,v)===i){if(-1===A)return F();h=A+y,A=e.indexOf(n,h),T=e.indexOf(r,h)}else if(-1!==T&&(T<A||-1===A))k.push(e.substring(h,T)),h=T+g,T=e.indexOf(r,h);else{if(-1===A)break;if(k.push(e.substring(h,A)),L(A+y),_&&(P(),d))return F();if(a&&b.length>=a)return F(!0)}else{for(C=h,h++;;){if(-1===(C=e.indexOf(t,C+1)))return f||w.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:b.length,index:h}),j();if(C===p-1)return j(e.substring(h,C).replace(D,t));if(t!==l||e[C+1]!==l){if(t===l||0===C||e[C-1]!==l){var O=q(-1===A?T:Math.min(T,A));if(e[C+1+O]===r){if(k.push(e.substring(h,C).replace(D,t)),h=C+1+O+g,T=e.indexOf(r,h),A=e.indexOf(n,h),_&&(P(),d))return F();if(a&&b.length>=a)return F(!0);break}var R=q(A);if(e.substr(C+1+R,y)===n){if(k.push(e.substring(h,C).replace(D,t)),L(C+1+R+y),T=e.indexOf(r,h),_&&(P(),d))return F();if(a&&b.length>=a)return F(!0);break}w.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:b.length,index:h}),C++}}else C++}if(_&&(P(),d))return F();if(a&&b.length>=a)return F(!0)}return j();function I(e){b.push(e),x=h}function q(t){var r=0;if(-1!==t){var n=e.substring(C+1,t);n&&""===n.trim()&&(r=n.length)}return r}function j(t){return f||(void 0===t&&(t=e.substr(h)),k.push(t),h=p,I(k),_&&P()),F()}function L(t){h=t,I(k),k=[],A=e.indexOf(n,h)}function F(e,t){return{data:t?b[0]:b,errors:w,meta:{delimiter:r,linebreak:n,aborted:d,truncated:!!e,cursor:x+(o||0)}}}function P(){s(F(void 0,!0)),b=[],w=[]}},this.abort=function(){d=!0},this.getCharIndex=function(){return h}}function p(e){if("object"!=typeof e||null===e)return e;var t=Array.isArray(e)?[]:{};for(var r in e)t[r]=p(e[r]);return t}function m(e){return"function"==typeof e}h.prototype=Object.create(h.prototype),h.prototype.constructor=h;const{ChunkStreamer:g}=u;function y(e){e=e||{},g.call(this,e),this.textDecoder=new TextDecoder(this._config.encoding),this.stream=async function(e){this._input=e;try{for await(const t of e)this.parseChunk(this.getStringChunk(t));this._finished=!0,this.parseChunk("")}catch(e){this._sendError(e)}},this._nextChunk=function(){},this.getStringChunk=function(e){return"string"==typeof e?e:this.textDecoder.decode(e,{stream:!0})}}y.prototype=Object.create(g.prototype),y.prototype.constructor=y;const v="object-row-table",_={dataType:null,batchType:null,id:"csv",module:"csv",name:"CSV",version:"4.2.1",extensions:["csv","tsv","dsv"],mimeTypes:["text/csv","text/tab-separated-values","text/dsv"],category:"table",parse:async(e,t)=>b((new TextDecoder).decode(e),t),parseText:(e,t)=>b(e,t),parseInBatches:function(e,t){"auto"===(t={...t}).batchSize&&(t.batchSize=4e3);const r={..._.options.csv,...t?.csv},n=new s;let i=!0,o=null,l=null,h=null;const d={...r,header:!1,download:!1,chunkSize:5242880,skipEmptyLines:!1,step(e){let s=e.data;if(r.skipEmptyLines&&""===s.flat().join("").trim())return;const u=e.meta.cursor;if(i&&!o&&("auto"===r.header?w(s):Boolean(r.header)))return void(o=s.map(k()));i&&(i=!1,o||(o=x(r.columnPrefix,s.length)),h=function(e,t){const r=t?{}:[];for(let n=0;n<e.length;n++){const i=t&&t[n]||n;switch(typeof e[n]){case"number":case"boolean":r[i]={name:String(i),index:n,type:Float32Array};break;default:r[i]={name:String(i),index:n,type:Array}}}return r}(s,o)),r.optimizeMemoryUsage&&(s=JSON.parse(JSON.stringify(s)));const d=r.shape||v;l=l||new a.Y(h,{shape:d,...t});try{l.addRow(s);const e=l&&l.getFullBatch({bytesUsed:u});e&&n.enqueue(e)}catch(e){n.enqueue(e)}},complete(e){try{const t=e.meta.cursor,r=l&&l.getFinalBatch({bytesUsed:t});r&&n.enqueue(r)}catch(e){n.enqueue(e)}n.close()}};return u.parse(e,d,y),n},options:{csv:{shape:v,optimizeMemoryUsage:!1,header:"auto",columnPrefix:"column",quoteChar:'"',escapeChar:'"',dynamicTyping:!0,comments:!1,skipEmptyLines:!0,delimitersToGuess:[",","\t","|",";"]}}};async function b(e,t){const r={..._.options.csv,...t?.csv},i=function(e){return u.parse(e,{download:!1,dynamicTyping:!0,preview:1}).data[0]}(e),s="auto"===r.header?w(i):Boolean(r.header),a={...r,header:s,download:!1,transformHeader:s?k():void 0,error:e=>{throw new Error(e)}},o=u.parse(e,a),l=o.data,h=o.meta.fields||x(r.columnPrefix,i.length),d=r.shape||v;switch(d){case"object-row-table":return{shape:"object-row-table",data:l.map((e=>Array.isArray(e)?(0,n.QY)(e,h):e))};case"array-row-table":return{shape:"array-row-table",data:l.map((e=>Array.isArray(e)?e:(0,n.aZ)(e,h)))};default:throw new Error(d)}}function w(e){return e&&e.every((e=>"string"==typeof e))}function k(){const e=new Set;return t=>{let r=t,n=1;for(;e.has(r);)r=`${t}.${n}`,n++;return e.add(r),r}}function x(e,t=0){const r=[];for(let n=0;n<t;n++)r.push(`${e}${n+1}`);return r}var E=r(21829),S=r(7541);function C(e,t={csv:{useDisplayNames:!0}}){const r=t.useDisplayNames||t.csv?.useDisplayNames,n=[(e.schema?.fields||[]).map((e=>{const t=e.metadata?.displayName;return r&&"string"==typeof t?t:e.name}))];for(const t of(0,E.a5)(e)){const r=[];for(let n=0;n<(0,E.wH)(e);++n){const e=t[n];r[n]=T(e)}n.push(r)}return(0,S.hG)(n)}const T=e=>null==e?null:e instanceof Date?e.toISOString():"object"==typeof e?JSON.stringify(e):String(e),A={id:"csv",version:"latest",module:"csv",name:"CSV",extensions:["csv"],mimeTypes:["text/csv"],options:{csv:{useDisplayNames:!1}},text:!0,encode:async(e,t)=>(new TextEncoder).encode(C(e,t)).buffer,encodeTextSync:(e,t)=>C(e,t)}}}]);