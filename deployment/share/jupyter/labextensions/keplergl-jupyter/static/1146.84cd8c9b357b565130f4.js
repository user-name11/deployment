"use strict";(self.webpackChunkkeplergl_jupyter=self.webpackChunkkeplergl_jupyter||[]).push([[1146],{47994:(e,r,o)=>{function s(e,r){if(!e)throw new Error(r||"loaders.gl assertion failed.")}o.d(r,{v:()=>s})},4654:(e,r,o)=>{o.d(r,{Bd:()=>t,Fr:()=>n});var s=o(65606);"undefined"!=typeof self&&self,"undefined"!=typeof window&&window,void 0!==o.g&&o.g,"undefined"!=typeof document&&document;const t="object"!=typeof s||"[object process]"!==String(s)||s.browser,n="undefined"!=typeof window&&void 0!==window.orientation,i=void 0!==s&&s.version&&/v([0-9]*)/.exec(s.version);i&&parseFloat(i[1])},86306:(e,r,o)=>{o.d(r,{Q:()=>t,x:()=>s});const s="latest",t=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.2.1"),globalThis._loadersgl_.version)},66595:(e,r,o)=>{o.d(r,{G:()=>i,q:()=>a});var s=o(47994),t=o(4654),n=o(86306);function i(e){const r=e.version!==n.Q?` (worker-utils@${n.Q})`:"";return`${e.name}@${e.version}${r}`}function a(e,r={}){const o=r[e.id]||{},i=t.Bd?`${e.id}-worker.js`:`${e.id}-worker-node.js`;let a=o.workerUrl;if(a||"compression"!==e.id||(a=r.workerUrl),"test"===r._workerType&&(a=t.Bd?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!a){let r=e.version;"latest"===r&&(r=n.x);const o=r?`@${r}`:"";a=`https://unpkg.com/@loaders.gl/${e.module}${o}/dist/${i}`}return(0,s.v)(a),a}},21146:(e,r,o)=>{o.d(r,{d:()=>i});var s=o(53722),t=o(66595),n=o(50866);async function i(e,r,o={},i={}){const u=(0,t.G)(e),c=s.A.getWorkerFarm(o),{source:l}=o,h={name:u,source:l};l||(h.url=(0,t.q)(e,o));const d=c.getWorkerPool(h),p=o.jobName||e.name,f=await d.startJob(p,a.bind(null,i)),g=(0,n.i)(o);return f.postMessage("process",{input:r,options:g}),(await f.result).result}async function a(e,r,o,s){switch(o){case"done":r.done(s);break;case"error":r.error(new Error(s.error));break;case"process":const{id:t,input:n,options:i}=s;try{if(!e.process)return void r.postMessage("error",{id:t,error:"Worker not set up to process on main thread"});const o=await e.process(n,i);r.postMessage("done",{id:t,result:o})}catch(e){const o=e instanceof Error?e.message:"unknown error";r.postMessage("error",{id:t,error:o})}break;default:console.warn(`process-on-worker: unknown message ${o}`)}}},53722:(e,r,o)=>{o.d(r,{A:()=>f});var s=o(4654);class t{terminate(){}}var n=o(47994);const i=new Map;function a(e){const r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}var u=o(50866);const c=()=>{};class l{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&s.Bd||void 0!==t&&!s.Bd}constructor(e){const{name:r,source:o,url:t}=e;(0,n.v)(o||t),this.name=r,this.source=o,this.url=t,this.onMessage=c,this.onError=e=>console.log(e),this.worker=s.Bd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=c,this.onError=c,this.worker.terminate(),this.terminated=!0}get isRunning(){return Boolean(this.onMessage)}postMessage(e,r){r=r||(0,u.Y)(e),this.worker.postMessage(e,r)}_getErrorFromErrorEvent(e){let r="Failed to load ";return r+=`worker ${this.name} from ${this.url}. `,e.message&&(r+=`${e.message} in `),e.lineno&&(r+=`:${e.lineno}:${e.colno}`),new Error(r)}_createBrowserWorker(){this._loadableURL=function(e){(0,n.v)(e.source&&!e.url||!e.source&&e.url);let r=i.get(e.source||e.url);return r||(e.url&&(r=(o=e.url).startsWith("http")?a(`try {\n  importScripts('${o}');\n} catch (error) {\n  console.error(error);\n  throw error;\n}`):o,i.set(e.url,r)),e.source&&(r=a(e.source),i.set(e.source,r))),(0,n.v)(r),r;var o}({source:this.source,url:this.url});const e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(new Error("No data received"))},e.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},e.onmessageerror=e=>console.error(e),e}_createNodeWorker(){let e;if(this.url){const r=this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`;e=new t(r,{eval:!1})}else{if(!this.source)throw new Error("no worker");e=new t(this.source,{eval:!0})}return e.on("message",(e=>{this.onMessage(e)})),e.on("error",(e=>{this.onError(e)})),e.on("exit",(e=>{})),e}}class h{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,r){this.name=e,this.workerThread=r,this.result=new Promise(((e,r)=>{this._resolve=e,this._reject=r}))}postMessage(e,r){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:r})}done(e){(0,n.v)(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){(0,n.v)(this.isRunning),this.isRunning=!1,this._reject(e)}}class d{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return l.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach((e=>e.destroy())),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,r=(e,r,o)=>e.done(o),o=(e,r)=>e.error(r)){const s=new Promise((s=>(this.jobQueue.push({name:e,onMessage:r,onError:o,onStart:s}),this)));return this._startQueuedJob(),await s}async _startQueuedJob(){if(!this.jobQueue.length)return;const e=this._getAvailableWorker();if(!e)return;const r=this.jobQueue.shift();if(r){this.onDebug({message:"Starting job",name:r.name,workerThread:e,backlog:this.jobQueue.length});const o=new h(r.name,e);e.onMessage=e=>r.onMessage(o,e.type,e.payload),e.onError=e=>r.onError(o,e),r.onStart(o);try{await o.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!s.Bd||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;const e=`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`;return new l({name:e,source:this.source,url:this.url})}return null}_getMaxConcurrency(){return s.Fr?this.maxMobileConcurrency:this.maxConcurrency}}const p={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class f{props;workerPools=new Map;static _workerFarm;static isSupported(){return l.isSupported()}static getWorkerFarm(e={}){return f._workerFarm=f._workerFarm||new f({}),f._workerFarm.setProps(e),f._workerFarm}constructor(e){this.props={...p},this.setProps(e),this.workerPools=new Map}destroy(){for(const e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){this.props={...this.props,...e};for(const e of this.workerPools.values())e.setProps(this._getWorkerPoolProps())}getWorkerPool(e){const{name:r,source:o,url:s}=e;let t=this.workerPools.get(r);return t||(t=new d({name:r,source:o,url:s}),t.setProps(this._getWorkerPoolProps()),this.workerPools.set(r,t)),t}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}},50866:(e,r,o)=>{function s(e,r=!0,o){const n=o||new Set;if(e)if(t(e))n.add(e);else if(t(e.buffer))n.add(e.buffer);else if(ArrayBuffer.isView(e));else if(r&&"object"==typeof e)for(const o in e)s(e[o],r,n);return void 0===o?Array.from(n):[]}function t(e){return!!e&&(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}function n(e){if(null===e)return{};const r=Object.assign({},e);return Object.keys(r).forEach((o=>{"object"!=typeof e[o]||ArrayBuffer.isView(e[o])||e[o]instanceof Array?"function"==typeof r[o]||r[o]instanceof RegExp?r[o]={}:r[o]=e[o]:r[o]=n(e[o])})),r}o.d(r,{Y:()=>s,i:()=>n})}}]);