"use strict";(self.webpackChunkkeplergl_jupyter=self.webpackChunkkeplergl_jupyter||[]).push([[6429],{96429:(t,e,n)=>{n.r(e),n.d(e,{JSONLoader:()=>w,JSONWriter:()=>N,NDJSONLoader:()=>P,_ClarinetParser:()=>d,_GeoJSONLoader:()=>dt,_GeoJSONWorkerLoader:()=>ft,_GeoJSONWriter:()=>At,_JSONPath:()=>g,_rebuildJsonObject:()=>A});var o=n(16458);function r(t){let e;switch(function(t){if(Array.isArray(t)){if(0===t.length)throw new Error("cannot deduce type of empty table");const e=t[0];if(Array.isArray(e))return"array-row-table";if(e&&"object"==typeof e)return"object-row-table"}if(t&&"object"==typeof t)return"columnar-table";throw new Error("invalid table")}(t)){case"array-row-table":e={shape:"array-row-table",data:t};break;case"object-row-table":e={shape:"object-row-table",data:t};break;case"columnar-table":e={shape:"columnar-table",data:t};break;default:throw new Error("table")}const n=(0,o.O)(e);return{...e,schema:n}}function s(t,e){try{const n=JSON.parse(t);return e.json?.table?r(i(n)||n):n}catch(t){throw new Error("JSONLoader: failed to parse JSON")}}function i(t){if(Array.isArray(t))return t;if(t&&"object"==typeof t)for(const e of Object.values(t)){const t=i(e);if(t)return t}return null}var a=n(5709);async function*c(t,e={}){const n=new TextDecoder(void 0,e);for await(const e of t)yield"string"==typeof e?e:n.decode(e,{stream:!0})}const l=Number.MAX_SAFE_INTEGER;var u;!function(t){t[t.BEGIN=0]="BEGIN",t[t.VALUE=1]="VALUE",t[t.OPEN_OBJECT=2]="OPEN_OBJECT",t[t.CLOSE_OBJECT=3]="CLOSE_OBJECT",t[t.OPEN_ARRAY=4]="OPEN_ARRAY",t[t.CLOSE_ARRAY=5]="CLOSE_ARRAY",t[t.TEXT_ESCAPE=6]="TEXT_ESCAPE",t[t.STRING=7]="STRING",t[t.BACKSLASH=8]="BACKSLASH",t[t.END=9]="END",t[t.OPEN_KEY=10]="OPEN_KEY",t[t.CLOSE_KEY=11]="CLOSE_KEY",t[t.TRUE=12]="TRUE",t[t.TRUE2=13]="TRUE2",t[t.TRUE3=14]="TRUE3",t[t.FALSE=15]="FALSE",t[t.FALSE2=16]="FALSE2",t[t.FALSE3=17]="FALSE3",t[t.FALSE4=18]="FALSE4",t[t.NULL=19]="NULL",t[t.NULL2=20]="NULL2",t[t.NULL3=21]="NULL3",t[t.NUMBER_DECIMAL_POINT=22]="NUMBER_DECIMAL_POINT",t[t.NUMBER_DIGIT=23]="NUMBER_DIGIT"}(u||(u={}));const h=101,p=/[\\"\n]/g,f={onready:()=>{},onopenobject:()=>{},onkey:()=>{},oncloseobject:()=>{},onopenarray:()=>{},onclosearray:()=>{},onvalue:()=>{},onerror:()=>{},onend:()=>{},onchunkparsed:()=>{}};class d{options=f;bufferCheckPosition=l;q="";c="";p="";closed=!1;closedRoot=!1;sawRoot=!1;error=null;state=u.BEGIN;stack=[];position=0;column=0;line=1;slashed=!1;unicodeI=0;unicodeS=null;depth=0;textNode;numberNode;constructor(t={}){this.options={...f,...t},this.textNode=void 0,this.numberNode="",this.emit("onready")}end(){return this.state===u.VALUE&&0===this.depth||this._error("Unexpected end"),this._closeValue(),this.c="",this.closed=!0,this.emit("onend"),this}resume(){return this.error=null,this}close(){return this.write(null)}emit(t,e){this.options[t]?.(e,this)}emitNode(t,e){this._closeValue(),this.emit(t,e)}write(t){if(this.error)throw this.error;if(this.closed)return this._error("Cannot write after close. Assign an onready handler.");if(null===t)return this.end();let e=0,n=t.charCodeAt(0),o=this.p;for(;n&&(o=n,this.c=n=t.charCodeAt(e++),o!==n?this.p=o:o=this.p,n);)switch(this.position++,10===n?(this.line++,this.column=0):this.column++,this.state){case u.BEGIN:123===n?this.state=u.OPEN_OBJECT:91===n?this.state=u.OPEN_ARRAY:y(n)||this._error("Non-whitespace before {[.");continue;case u.OPEN_KEY:case u.OPEN_OBJECT:if(y(n))continue;if(this.state===u.OPEN_KEY)this.stack.push(u.CLOSE_KEY);else{if(125===n){this.emit("onopenobject"),this.depth++,this.emit("oncloseobject"),this.depth--,this.state=this.stack.pop()||u.VALUE;continue}this.stack.push(u.CLOSE_OBJECT)}34===n?this.state=u.STRING:this._error('Malformed object key should start with "');continue;case u.CLOSE_KEY:case u.CLOSE_OBJECT:if(y(n))continue;58===n?(this.state===u.CLOSE_OBJECT?(this.stack.push(u.CLOSE_OBJECT),this._closeValue("onopenobject"),this.depth++):this._closeValue("onkey"),this.state=u.VALUE):125===n?(this.emitNode("oncloseobject"),this.depth--,this.state=this.stack.pop()||u.VALUE):44===n?(this.state===u.CLOSE_OBJECT&&this.stack.push(u.CLOSE_OBJECT),this._closeValue(),this.state=u.OPEN_KEY):this._error("Bad object");continue;case u.OPEN_ARRAY:case u.VALUE:if(y(n))continue;if(this.state===u.OPEN_ARRAY){if(this.emit("onopenarray"),this.depth++,this.state=u.VALUE,93===n){this.emit("onclosearray"),this.depth--,this.state=this.stack.pop()||u.VALUE;continue}this.stack.push(u.CLOSE_ARRAY)}34===n?this.state=u.STRING:123===n?this.state=u.OPEN_OBJECT:91===n?this.state=u.OPEN_ARRAY:116===n?this.state=u.TRUE:102===n?this.state=u.FALSE:110===n?this.state=u.NULL:45===n?this.numberNode+="-":48<=n&&n<=57?(this.numberNode+=String.fromCharCode(n),this.state=u.NUMBER_DIGIT):this._error("Bad value");continue;case u.CLOSE_ARRAY:if(44===n)this.stack.push(u.CLOSE_ARRAY),this._closeValue("onvalue"),this.state=u.VALUE;else if(93===n)this.emitNode("onclosearray"),this.depth--,this.state=this.stack.pop()||u.VALUE;else{if(y(n))continue;this._error("Bad array")}continue;case u.STRING:void 0===this.textNode&&(this.textNode="");let r=e-1,s=this.slashed,i=this.unicodeI;t:for(;;){for(;i>0;)if(this.unicodeS+=String.fromCharCode(n),n=t.charCodeAt(e++),this.position++,4===i?(this.textNode+=String.fromCharCode(parseInt(this.unicodeS,16)),i=0,r=e-1):i++,!n)break t;if(34===n&&!s){this.state=this.stack.pop()||u.VALUE,this.textNode+=t.substring(r,e-1),this.position+=e-1-r;break}if(92===n&&!s&&(s=!0,this.textNode+=t.substring(r,e-1),this.position+=e-1-r,n=t.charCodeAt(e++),this.position++,!n))break;if(s){if(s=!1,110===n?this.textNode+="\n":114===n?this.textNode+="\r":116===n?this.textNode+="\t":102===n?this.textNode+="\f":98===n?this.textNode+="\b":117===n?(i=1,this.unicodeS=""):this.textNode+=String.fromCharCode(n),n=t.charCodeAt(e++),this.position++,r=e-1,n)continue;break}p.lastIndex=e;const o=p.exec(t);if(null===o){e=t.length+1,this.textNode+=t.substring(r,e-1),this.position+=e-1-r;break}if(e=o.index+1,n=t.charCodeAt(o.index),!n){this.textNode+=t.substring(r,e-1),this.position+=e-1-r;break}}this.slashed=s,this.unicodeI=i;continue;case u.TRUE:114===n?this.state=u.TRUE2:this._error(`Invalid true started with t${n}`);continue;case u.TRUE2:117===n?this.state=u.TRUE3:this._error(`Invalid true started with tr${n}`);continue;case u.TRUE3:n===h?(this.emit("onvalue",!0),this.state=this.stack.pop()||u.VALUE):this._error(`Invalid true started with tru${n}`);continue;case u.FALSE:97===n?this.state=u.FALSE2:this._error(`Invalid false started with f${n}`);continue;case u.FALSE2:108===n?this.state=u.FALSE3:this._error(`Invalid false started with fa${n}`);continue;case u.FALSE3:115===n?this.state=u.FALSE4:this._error(`Invalid false started with fal${n}`);continue;case u.FALSE4:n===h?(this.emit("onvalue",!1),this.state=this.stack.pop()||u.VALUE):this._error(`Invalid false started with fals${n}`);continue;case u.NULL:117===n?this.state=u.NULL2:this._error(`Invalid null started with n${n}`);continue;case u.NULL2:108===n?this.state=u.NULL3:this._error(`Invalid null started with nu${n}`);continue;case u.NULL3:108===n?(this.emit("onvalue",null),this.state=this.stack.pop()||u.VALUE):this._error(`Invalid null started with nul${n}`);continue;case u.NUMBER_DECIMAL_POINT:46===n?(this.numberNode+=".",this.state=u.NUMBER_DIGIT):this._error("Leading zero not followed by .");continue;case u.NUMBER_DIGIT:48<=n&&n<=57?this.numberNode+=String.fromCharCode(n):46===n?(-1!==this.numberNode.indexOf(".")&&this._error("Invalid number has two dots"),this.numberNode+="."):n===h||69===n?(-1===this.numberNode.indexOf("e")&&-1===this.numberNode.indexOf("E")||this._error("Invalid number has two exponential"),this.numberNode+="e"):43===n||45===n?(o!==h&&69!==o&&this._error("Invalid symbol in number"),this.numberNode+=String.fromCharCode(n)):(this._closeNumber(),e--,this.state=this.stack.pop()||u.VALUE);continue;default:this._error(`Unknown state: ${this.state}`)}return this.position>=this.bufferCheckPosition&&function(t){const e=Math.max(l,10);let n=0;for(const o of["textNode","numberNode"]){const r=void 0===t[o]?0:t[o].length;r>e&&("text"===o||t._error(`Max buffer length exceeded: ${o}`)),n=Math.max(n,r)}t.bufferCheckPosition=l-n+t.position}(this),this.emit("onchunkparsed"),this}_closeValue(t="onvalue"){void 0!==this.textNode&&this.emit(t,this.textNode),this.textNode=void 0}_closeNumber(){this.numberNode&&this.emit("onvalue",parseFloat(this.numberNode)),this.numberNode=""}_error(t=""){this._closeValue(),t+=`\nLine: ${this.line}\nColumn: ${this.column}\nChar: ${this.c}`;const e=new Error(t);this.error=e,this.emit("onerror",e)}}function y(t){return 13===t||10===t||32===t||9===t}class g{path;constructor(t=null){if(this.path=["$"],t instanceof g)this.path=[...t.path];else if(Array.isArray(t))this.path.push(...t);else if("string"==typeof t&&(this.path=t.split("."),"$"!==this.path[0]))throw new Error("JSONPaths must start with $")}clone(){return new g(this)}toString(){return this.path.join(".")}push(t){this.path.push(t)}pop(){return this.path.pop()}set(t){this.path[this.path.length-1]=t}equals(t){if(!this||!t||this.path.length!==t.path.length)return!1;for(let e=0;e<this.path.length;++e)if(this.path[e]!==t.path[e])return!1;return!0}setFieldAtPath(t,e){const n=[...this.path];n.shift();const o=n.pop();for(const e of n)t=t[e];t[o]=e}getFieldAtPath(t){const e=[...this.path];e.shift();const n=e.pop();for(const n of e)t=t[n];return t[n]}}class x{parser;result=void 0;previousStates=[];currentState=Object.freeze({container:[],key:null});jsonpath=new g;constructor(t){this.reset(),this.parser=new d({onready:()=>{this.jsonpath=new g,this.previousStates.length=0,this.currentState.container.length=0},onopenobject:t=>{this._openObject({}),void 0!==t&&this.parser.emit("onkey",t)},onkey:t=>{this.jsonpath.set(t),this.currentState.key=t},oncloseobject:()=>{this._closeObject()},onopenarray:()=>{this._openArray()},onclosearray:()=>{this._closeArray()},onvalue:t=>{this._pushOrSet(t)},onerror:t=>{throw t},onend:()=>{this.result=this.currentState.container.pop()},...t})}reset(){this.result=void 0,this.previousStates=[],this.currentState=Object.freeze({container:[],key:null}),this.jsonpath=new g}write(t){this.parser.write(t)}close(){this.parser.close()}_pushOrSet(t){const{container:e,key:n}=this.currentState;null!==n?(e[n]=t,this.currentState.key=null):e.push(t)}_openArray(t=[]){this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!0,key:null}}_closeArray(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}_openObject(t={}){this.jsonpath.push(null),this._pushOrSet(t),this.previousStates.push(this.currentState),this.currentState={container:t,isArray:!1,key:null}}_closeObject(){this.jsonpath.pop(),this.currentState=this.previousStates.pop()}}class m extends x{jsonPaths;streamingJsonPath=null;streamingArray=null;topLevelObject=null;constructor(t={}){super({onopenarray:()=>{if(!this.streamingArray&&this._matchJSONPath())return this.streamingJsonPath=this.getJsonPath().clone(),this.streamingArray=[],void this._openArray(this.streamingArray);this._openArray()},onopenobject:t=>{this.topLevelObject?this._openObject({}):(this.topLevelObject={},this._openObject(this.topLevelObject)),void 0!==t&&this.parser.emit("onkey",t)}});const e=t.jsonpaths||[];this.jsonPaths=e.map((t=>new g(t)))}write(t){super.write(t);let e=[];return this.streamingArray&&(e=[...this.streamingArray],this.streamingArray.length=0),e}getPartialResult(){return this.topLevelObject}getStreamingJsonPath(){return this.streamingJsonPath}getStreamingJsonPathAsString(){return this.streamingJsonPath&&this.streamingJsonPath.toString()}getJsonPath(){return this.jsonpath}_matchJSONPath(){const t=this.getJsonPath();if(0===this.jsonPaths.length)return!0;for(const e of this.jsonPaths)if(e.equals(t))return!0;return!1}}async function*b(t,e){const n=c(t),{metadata:o}=e,{jsonpaths:r}=e.json||{};let s=!0;const i=new a.Y(null,e),l=new m({jsonpaths:r});for await(const t of n){const n=l.write(t),r=n.length>0&&l.getStreamingJsonPathAsString();if(n.length>0&&s){if(o){const t={shape:e?.json?.shape||"array-row-table",batchType:"partial-result",data:[],length:0,bytesUsed:0,container:l.getPartialResult(),jsonpath:r};yield t}s=!1}for(const t of n){i.addRow(t);const e=i.getFullBatch({jsonpath:r});e&&(yield e)}i.chunkComplete(t);const a=i.getFullBatch({jsonpath:r});a&&(yield a)}const u=l.getStreamingJsonPathAsString(),h=i.getFinalBatch({jsonpath:u});if(h&&(yield h),o){const t={shape:"json",batchType:"final-result",container:l.getPartialResult(),jsonpath:l.getStreamingJsonPathAsString(),data:[],length:0};yield t}}function A(t,e){if(function(t){if(!t)throw new Error("loader assertion failed.")}("final-result"===t.batchType),"$"===t.jsonpath)return e;if(t.jsonpath&&t.jsonpath.length>1){const n=t.container;return new g(t.jsonpath).setFieldAtPath(n,e),n}return t.container}const w={dataType:null,batchType:null,name:"JSON",id:"json",module:"json",version:"4.2.1",extensions:["json","geojson"],mimeTypes:["application/json"],category:"table",text:!0,options:{json:{shape:void 0,table:!1,jsonpaths:[]}},parse:async function(t,e){return E((new TextDecoder).decode(t),e)},parseTextSync:E,parseInBatches:function(t,e){return b(t,{...e,json:{...w.options.json,...e?.json}})}};function E(t,e){return s(t,{...e,json:{...w.options.json,...e?.json}})}function S(t){return r(t.trim().split("\n").map(((t,e)=>{try{return JSON.parse(t)}catch(t){throw new Error(`NDJSONLoader: failed to parse JSON on line ${e+1}`)}})))}const P={dataType:null,batchType:null,name:"NDJSON",id:"ndjson",module:"json",version:"4.2.1",extensions:["ndjson","jsonl"],mimeTypes:["application/x-ndjson","application/jsonlines","application/json-seq"],category:"table",text:!0,parse:async t=>S((new TextDecoder).decode(t)),parseTextSync:S,parseInBatches:async function*(t,e){const n=async function*(t){let e=1;for await(const n of t)yield{counter:e,line:n},e++}(async function*(t){let e="";for await(const n of t){let t;for(e+=n;(t=e.indexOf("\n"))>=0;){const n=e.slice(0,t+1);e=e.slice(t+1),yield n}}e.length>0&&(yield e)}(c(t))),o=new a.Y(null,{...e,shape:"row-table"});for await(const{counter:t,line:e}of n)try{const t=JSON.parse(e);o.addRow(t),o.chunkComplete(e);const n=o.getFullBatch();n&&(yield n)}catch(e){throw new Error(`NDJSONLoader: failed to parse JSON on line ${t}`)}const r=o.getFinalBatch();r&&(yield r)},options:{}};var v=n(21829);function j(t,e){const n=e?.json?.shape||"object-row-table",o=[],r=(0,v.r2)(t,n);for(const t of r)o.push(JSON.stringify(t));return`[${o.join(",")}]`}const N={id:"json",version:"latest",module:"json",name:"JSON",extensions:["json"],mimeTypes:["application/json"],options:{},text:!0,encode:async(t,e)=>(new TextEncoder).encode(j(t,e)).buffer,encodeTextSync:(t,e)=>j(t,e)},L={x:0,y:1,z:2};function O(t,e={}){const{start:n=0,end:o=t.length,plane:r="xy"}=e,s=e.size||2;let i=0;const a=L[r[0]],c=L[r[1]];for(let e=n,r=o-s;e<o;e+=s)i+=(t[e+a]-t[r+a])*(t[e+c]+t[r+c]),r=e;return i/2}function _(t,e,n,o,r,s,i){let a,c;void 0===s&&(s=O(t,{start:e,end:n,size:o,plane:i}));let l=L[i[0]],u=L[i[1]];if(r===s<0)for(a=e;a<n;a+=o)c=H(a,t[a+l],t[a+u],c);else for(a=n-o;a>=e;a-=o)c=H(a,t[a+l],t[a+u],c);return c&&V(c,c.next)&&(X(c),c=c.next),c}function I(t,e){if(!t)return t;e||(e=t);let n,o=t;do{if(n=!1,o.steiner||!V(o,o.next)&&0!==D(o.prev,o,o.next))o=o.next;else{if(X(o),o=e=o.prev,o===o.next)break;n=!0}}while(n||o!==e);return e}function C(t,e,n,o,r,s,i){if(!t)return;!i&&s&&function(t,e,n,o){let r=t;do{0===r.z&&(r.z=z(r.x,r.y,e,n,o)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){let e,n,o,r,s,i,a,c,l=1;do{for(r=t,t=null,c=null,o=0;r;){for(o++,i=r,s=0,n=0;n<l&&(s++,i=i.nextZ,i);n++);for(a=l;s>0||a>0&&i;)0!==s&&(0===a||!i||r.z<=i.z)?(e=r,r=r.nextZ,s--):(e=i,i=i.nextZ,a--),c?c.nextZ=e:t=e,e.prevZ=c,c=e;r=i}c.nextZ=null,l*=2}while(o>1)}(r)}(t,o,r,s);let a,c,l=t;for(;t.prev!==t.next;)if(a=t.prev,c=t.next,s?U(t,o,r,s):k(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(c.i/n|0),X(t),t=c.next,l=c.next;else if((t=c)===l){i?1===i?C(t=T(I(t),e,n),e,n,o,r,s,2):2===i&&F(t,e,n,o,r,s):C(I(t),e,n,o,r,s,1);break}}function k(t){const e=t.prev,n=t,o=t.next;if(D(e,n,o)>=0)return!1;const r=e.x,s=n.x,i=o.x,a=e.y,c=n.y,l=o.y,u=r<s?r<i?r:i:s<i?s:i,h=a<c?a<l?a:l:c<l?c:l,p=r>s?r>i?r:i:s>i?s:i,f=a>c?a>l?a:l:c>l?c:l;let d=o.next;for(;d!==e;){if(d.x>=u&&d.x<=p&&d.y>=h&&d.y<=f&&Z(r,a,s,c,i,l,d.x,d.y)&&D(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function U(t,e,n,o){const r=t.prev,s=t,i=t.next;if(D(r,s,i)>=0)return!1;const a=r.x,c=s.x,l=i.x,u=r.y,h=s.y,p=i.y,f=a<c?a<l?a:l:c<l?c:l,d=u<h?u<p?u:p:h<p?h:p,y=a>c?a>l?a:l:c>l?c:l,g=u>h?u>p?u:p:h>p?h:p,x=z(f,d,e,n,o),m=z(y,g,e,n,o);let b=t.prevZ,A=t.nextZ;for(;b&&b.z>=x&&A&&A.z<=m;){if(b.x>=f&&b.x<=y&&b.y>=d&&b.y<=g&&b!==r&&b!==i&&Z(a,u,c,h,l,p,b.x,b.y)&&D(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,A.x>=f&&A.x<=y&&A.y>=d&&A.y<=g&&A!==r&&A!==i&&Z(a,u,c,h,l,p,A.x,A.y)&&D(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;b&&b.z>=x;){if(b.x>=f&&b.x<=y&&b.y>=d&&b.y<=g&&b!==r&&b!==i&&Z(a,u,c,h,l,p,b.x,b.y)&&D(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;A&&A.z<=m;){if(A.x>=f&&A.x<=y&&A.y>=d&&A.y<=g&&A!==r&&A!==i&&Z(a,u,c,h,l,p,A.x,A.y)&&D(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function T(t,e,n){let o=t;do{const r=o.prev,s=o.next.next;!V(r,s)&&G(r,o,o.next,s)&&W(r,s)&&W(s,r)&&(e.push(r.i/n|0),e.push(o.i/n|0),e.push(s.i/n|0),X(o),X(o.next),o=t=s),o=o.next}while(o!==t);return I(o)}function F(t,e,n,o,r,s){let i=t;do{let t=i.next.next;for(;t!==i.prev;){if(i.i!==t.i&&$(i,t)){let a=q(i,t);return i=I(i,i.next),a=I(a,a.next),C(i,e,n,o,r,s,0),void C(a,e,n,o,r,s,0)}t=t.next}i=i.next}while(i!==t)}function R(t,e){return t.x-e.x}function J(t,e){const n=function(t,e){let n=e;const o=t.x,r=t.y;let s,i=-1/0;do{if(r<=n.y&&r>=n.next.y&&n.next.y!==n.y){const t=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=o&&t>i&&(i=t,s=n.x<n.next.x?n:n.next,t===o))return s}n=n.next}while(n!==e);if(!s)return null;const a=s,c=s.x,l=s.y;let u,h=1/0;n=s;do{o>=n.x&&n.x>=c&&o!==n.x&&Z(r<l?o:i,r,c,l,r<l?i:o,r,n.x,n.y)&&(u=Math.abs(r-n.y)/(o-n.x),W(n,t)&&(u<h||u===h&&(n.x>s.x||n.x===s.x&&B(s,n)))&&(s=n,h=u)),n=n.next}while(n!==a);return s}(t,e);if(!n)return e;const o=q(n,t);return I(o,o.next),I(n,n.next)}function B(t,e){return D(t.prev,t,e.prev)<0&&D(e.next,t,t.next)<0}function z(t,e,n,o,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-o)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function M(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Z(t,e,n,o,r,s,i,a){return(r-i)*(e-a)>=(t-i)*(s-a)&&(t-i)*(o-a)>=(n-i)*(e-a)&&(n-i)*(s-a)>=(r-i)*(o-a)}function $(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&G(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(W(t,e)&&W(e,t)&&function(t,e){let n=t,o=!1;const r=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&r<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(o=!o),n=n.next}while(n!==t);return o}(t,e)&&(D(t.prev,t,e.prev)||D(t,e.prev,e))||V(t,e)&&D(t.prev,t,t.next)>0&&D(e.prev,e,e.next)>0)}function D(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function V(t,e){return t.x===e.x&&t.y===e.y}function G(t,e,n,o){const r=K(D(t,e,n)),s=K(D(t,e,o)),i=K(D(n,o,t)),a=K(D(n,o,e));return r!==s&&i!==a||!(0!==r||!Y(t,n,e))||!(0!==s||!Y(t,o,e))||!(0!==i||!Y(n,t,o))||!(0!==a||!Y(n,e,o))}function Y(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function K(t){return t>0?1:t<0?-1:0}function W(t,e){return D(t.prev,t,t.next)<0?D(t,e,t.next)>=0&&D(t,t.prev,e)>=0:D(t,e,t.prev)<0||D(t,t.next,e)<0}function q(t,e){const n=new Q(t.i,t.x,t.y),o=new Q(e.i,e.x,e.y),r=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,o.next=n,n.prev=o,s.next=o,o.prev=s,o}function H(t,e,n,o){const r=new Q(t,e,n);return o?(r.next=o.next,r.prev=o,o.next.prev=r,o.next=r):(r.prev=r,r.next=r),r}function X(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}class Q{constructor(t,e,n){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=n}}function tt(t,e,n,o){n.push(e.length),e.push(...t);for(let n=t.length;n<o.coordLength;n++)e.push(0)}function et(t,e,n,o){n.push(e.length);for(const n of t){e.push(...n);for(let t=n.length;t<o.coordLength;t++)e.push(0)}}function nt(t,e,n,o,r){let s=0;const i=[],a=[];for(const n of t){let t=O(n.map((t=>t.slice(0,2))).flat());const o=t<0;r.fixRingWinding&&(0===s&&!o||s>0&&o)&&(n.reverse(),t=-t),i.push(t),et(n,e,a,r),s++}s>0&&(o.push(i),n.push(a))}function ot(t,e,n){const o=function(t){const e={};for(const n of t)if(n.properties)for(const t in n.properties){const o=n.properties[t];e[t]=ht(o,e[t])}return e}(t),r=Object.keys(o).filter((t=>o[t]!==Array));return function(t,e,n){const{pointPositionsCount:o,pointFeaturesCount:r,linePositionsCount:s,linePathsCount:i,lineFeaturesCount:a,polygonPositionsCount:c,polygonObjectsCount:l,polygonRingsCount:u,polygonFeaturesCount:h,propArrayTypes:p,coordLength:f}=e,{numericPropKeys:d=[],PositionDataType:y=Float32Array,triangulate:g=!0}=n,x=t[0]&&"id"in t[0],m=t.length>65535?Uint32Array:Uint16Array,b={type:"Point",positions:new y(o*f),globalFeatureIds:new m(o),featureIds:r>65535?new Uint32Array(o):new Uint16Array(o),numericProps:{},properties:[],fields:[]},A={type:"LineString",pathIndices:s>65535?new Uint32Array(i+1):new Uint16Array(i+1),positions:new y(s*f),globalFeatureIds:new m(s),featureIds:a>65535?new Uint32Array(s):new Uint16Array(s),numericProps:{},properties:[],fields:[]},w={type:"Polygon",polygonIndices:c>65535?new Uint32Array(l+1):new Uint16Array(l+1),primitivePolygonIndices:c>65535?new Uint32Array(u+1):new Uint16Array(u+1),positions:new y(c*f),globalFeatureIds:new m(c),featureIds:h>65535?new Uint32Array(c):new Uint16Array(c),numericProps:{},properties:[],fields:[]};g&&(w.triangles=[]);for(const t of[b,A,w])for(const e of d){const n=p[e];t.numericProps[e]=new n(t.positions.length/f)}A.pathIndices[i]=s,w.polygonIndices[l]=c,w.primitivePolygonIndices[u]=c;const E={pointPosition:0,pointFeature:0,linePosition:0,linePath:0,lineFeature:0,polygonPosition:0,polygonObject:0,polygonRing:0,polygonFeature:0,feature:0};for(const e of t){const t=e.geometry,n=e.properties||{};switch(t.type){case"Point":rt(t,b,E,f,n),b.properties.push(ut(n,d)),x&&b.fields.push({id:e.id}),E.pointFeature++;break;case"LineString":st(t,A,E,f,n),A.properties.push(ut(n,d)),x&&A.fields.push({id:e.id}),E.lineFeature++;break;case"Polygon":it(t,w,E,f,n),w.properties.push(ut(n,d)),x&&w.fields.push({id:e.id}),E.polygonFeature++;break;default:throw new Error("Invalid geometry type")}E.feature++}return function(t,e,n,o){const r={shape:"binary-feature-collection",points:{...t,positions:{value:t.positions,size:o},globalFeatureIds:{value:t.globalFeatureIds,size:1},featureIds:{value:t.featureIds,size:1},numericProps:ct(t.numericProps,1)},lines:{...e,positions:{value:e.positions,size:o},pathIndices:{value:e.pathIndices,size:1},globalFeatureIds:{value:e.globalFeatureIds,size:1},featureIds:{value:e.featureIds,size:1},numericProps:ct(e.numericProps,1)},polygons:{...n,positions:{value:n.positions,size:o},polygonIndices:{value:n.polygonIndices,size:1},primitivePolygonIndices:{value:n.primitivePolygonIndices,size:1},globalFeatureIds:{value:n.globalFeatureIds,size:1},featureIds:{value:n.featureIds,size:1},numericProps:ct(n.numericProps,1)}};return r.polygons&&n.triangles&&(r.polygons.triangles={value:new Uint32Array(n.triangles),size:1}),r}(b,A,w,f)}(t,{propArrayTypes:o,...e},{numericPropKeys:n&&n.numericPropKeys||r,PositionDataType:n?n.PositionDataType:Float32Array,triangulate:!n||n.triangulate})}function rt(t,e,n,o,r){e.positions.set(t.data,n.pointPosition*o);const s=t.data.length/o;lt(e,r,n.pointPosition,s),e.globalFeatureIds.fill(n.feature,n.pointPosition,n.pointPosition+s),e.featureIds.fill(n.pointFeature,n.pointPosition,n.pointPosition+s),n.pointPosition+=s}function st(t,e,n,o,r){e.positions.set(t.data,n.linePosition*o);const s=t.data.length/o;lt(e,r,n.linePosition,s),e.globalFeatureIds.fill(n.feature,n.linePosition,n.linePosition+s),e.featureIds.fill(n.lineFeature,n.linePosition,n.linePosition+s);for(let r=0,s=t.indices.length;r<s;++r){const i=t.indices[r],a=r===s-1?t.data.length:t.indices[r+1];e.pathIndices[n.linePath++]=n.linePosition,n.linePosition+=(a-i)/o}}function it(t,e,n,o,r){e.positions.set(t.data,n.polygonPosition*o);const s=t.data.length/o;lt(e,r,n.polygonPosition,s),e.globalFeatureIds.fill(n.feature,n.polygonPosition,n.polygonPosition+s),e.featureIds.fill(n.polygonFeature,n.polygonPosition,n.polygonPosition+s);for(let r=0,s=t.indices.length;r<s;++r){const s=n.polygonPosition;e.polygonIndices[n.polygonObject++]=s;const i=t.areas[r],a=t.indices[r],c=t.indices[r+1];for(let r=0,s=a.length;r<s;++r){const i=a[r],l=r===s-1?void 0===c?t.data.length:c[0]:a[r+1];e.primitivePolygonIndices[n.polygonRing++]=n.polygonPosition,n.polygonPosition+=(l-i)/o}at(e,i,a,{startPosition:s,endPosition:n.polygonPosition,coordLength:o})}}function at(t,e,n,{startPosition:o,endPosition:r,coordLength:s}){if(!t.triangles)return;const i=o*s,a=r*s,c=t.positions.subarray(i,a),l=n[0],u=function(t,e,n=2,o,r="xy"){const s=e&&e.length,i=s?e[0]*n:t.length;let a=_(t,0,i,n,!0,o&&o[0],r);const c=[];if(!a||a.next===a.prev)return c;let l,u,h,p,f,d,y;if(s&&(a=function(t,e,n,o,r,s){const i=[];let a,c,l,u,h;for(a=0,c=e.length;a<c;a++)l=e[a]*o,u=a<c-1?e[a+1]*o:t.length,h=_(t,l,u,o,!1,r&&r[a+1],s),h===h.next&&(h.steiner=!0),i.push(M(h));for(i.sort(R),a=0;a<i.length;a++)n=J(i[a],n);return n}(t,e,a,n,o,r)),t.length>80*n){p=u=t[0],f=h=t[1];for(let e=n;e<i;e+=n)d=t[e],y=t[e+1],d<p&&(p=d),y<f&&(f=y),d>u&&(u=d),y>h&&(h=y);l=Math.max(u-p,h-f),l=0!==l?32767/l:0}return C(a,c,n,p,f,l,0),c}(c,n.slice(1).map((t=>(t-l)/s)),s,e);for(let e=0,n=u.length;e<n;++e)t.triangles.push(o+u[e])}function ct(t,e){const n={};for(const o in t)n[o]={value:t[o],size:e};return n}function lt(t,e,n,o){for(const r in t.numericProps)if(r in e){const s=e[r];t.numericProps[r].fill(s,n,n+o)}}function ut(t,e){const n={};for(const o in t)e.includes(o)||(n[o]=t[o]);return n}function ht(t,e){return e!==Array&&Number.isFinite(t)?e===Float64Array||Math.fround(t)!==t?Float64Array:Float32Array:Array}function pt(t,e={fixRingWinding:!0,triangulate:!0}){const n=function(t){let e=0,n=0,o=0,r=0,s=0,i=0,a=0,c=0,l=0;const u=new Set;for(const h of t){const t=h.geometry;switch(t.type){case"Point":n++,e++,u.add(t.coordinates.length);break;case"MultiPoint":n++,e+=t.coordinates.length;for(const e of t.coordinates)u.add(e.length);break;case"LineString":s++,o+=t.coordinates.length,r++;for(const e of t.coordinates)u.add(e.length);break;case"MultiLineString":s++;for(const e of t.coordinates){o+=e.length,r++;for(const t of e)u.add(t.length)}break;case"Polygon":l++,a++,c+=t.coordinates.length;const h=t.coordinates.flat();i+=h.length;for(const t of h)u.add(t.length);break;case"MultiPolygon":l++;for(const e of t.coordinates){a++,c+=e.length;const t=e.flat();i+=t.length;for(const e of t)u.add(e.length)}break;default:throw new Error(`Unsupported geometry type: ${t.type}`)}}return{coordLength:u.size>0?Math.max(...u):2,pointPositionsCount:e,pointFeaturesCount:n,linePositionsCount:o,linePathsCount:r,lineFeaturesCount:s,polygonPositionsCount:i,polygonObjectsCount:a,polygonRingsCount:c,polygonFeaturesCount:l}}(t),o=n.coordLength,{fixRingWinding:r}=e;return ot(function(t,e={coordLength:2,fixRingWinding:!0}){return t.map((t=>function(t,e){const{geometry:n}=t;if("GeometryCollection"===n.type)throw new Error("GeometryCollection type not supported");const o=[],r=[];let s,i;switch(n.type){case"Point":i="Point",tt(n.coordinates,o,r,e);break;case"MultiPoint":i="Point",n.coordinates.map((t=>tt(t,o,r,e)));break;case"LineString":i="LineString",et(n.coordinates,o,r,e);break;case"MultiLineString":i="LineString",n.coordinates.map((t=>et(t,o,r,e)));break;case"Polygon":i="Polygon",s=[],nt(n.coordinates,o,r,s,e);break;case"MultiPolygon":i="Polygon",s=[],n.coordinates.map((t=>nt(t,o,r,s,e)));break;default:throw new Error(`Unknown type: ${i}`)}return{...t,geometry:{type:i,indices:r,data:o,areas:s}}}(t,e)))}(t,{coordLength:o,fixRingWinding:r}),n,{numericPropKeys:e.numericPropKeys,PositionDataType:e.PositionDataType||Float32Array,triangulate:e.triangulate})}const ft={dataType:null,batchType:null,name:"GeoJSON",id:"geojson",module:"geojson",version:"4.2.1",worker:!0,extensions:["geojson"],mimeTypes:["application/geo+json"],category:"geometry",text:!0,options:{geojson:{shape:"object-row-table"},json:{shape:"object-row-table",jsonpaths:["$","$.features"]},gis:{format:"geojson"}}},dt={...ft,parse:async function(t,e){return yt((new TextDecoder).decode(t),e)},parseTextSync:yt,parseInBatches:function(t,e){(e={...dt.options,...e}).json={...dt.options.geojson,...e.geojson};const n=b(t,e);return"binary"===e.gis.format?async function*(t){for await(const e of t)e.data=pt(e.data),yield e}(n):n}};function yt(t,e){let n;(e={...dt.options,...e}).geojson={...dt.options.geojson,...e.geojson},e.gis=e.gis||{};try{n=JSON.parse(t)}catch{n={}}const o={shape:"geojson-table",type:"FeatureCollection",features:n?.features||[]};return"binary"===e.gis.format?pt(o.features):o}function gt(t){const e=t.schema?.fields.findIndex((t=>"geometry"===t.name))??-1;if(e>-1)return e;if((0,v.pg)(t)>0){const e=(0,v.q0)(t,0);for(let n=0;n<(0,v.wH)(t);n++){const t=e?.[n];if(t&&"object"==typeof t)return n}}throw new Error("Failed to detect geometry column")}function xt(t,e,n,o){const r=(0,v.gt)(t,e);if(!r)return;const s=function(t,e,n){const o=function(t,e,n=[]){const o={};for(let r=0;r<(0,v.wH)(t);++r){const s=t.schema?.fields[r].name;s&&!n.includes(r)&&(o[s]=e[s])}return o}(t,e,[n]),r=t.schema?.fields[n].name;let s=r&&e[r];if(!s)return{type:"Feature",geometry:null,properties:o};if("string"==typeof s)try{s=JSON.parse(s)}catch(t){throw new Error("Invalid string geometry")}if("object"!=typeof s||"string"!=typeof s?.type)throw new Error("invalid geometry column value");return"Feature"===s?.type?{...s,properties:o}:{type:"Feature",geometry:s,properties:o}}(t,r,n),i=JSON.stringify(s);o.push(i)}class mt{chunkSize;strings=[];totalLength=0;textEncoder=new TextEncoder;constructor(t){this.chunkSize=t}push(...t){for(const e of t)this.strings.push(e),this.totalLength+=e.length}isFull(){return this.totalLength>=this.chunkSize}getArrayBufferBatch(){return this.textEncoder.encode(this.getStringBatch()).buffer}getStringBatch(){const t=this.strings.join("");return this.strings=[],this.totalLength=0,t}}async function*bt(t,e={}){const n={geojson:{},chunkSize:1e4,...e},o=new mt(n.chunkSize);n.geojson.featureArray||o.push("{\n",'"type": "FeatureCollection",\n','"features":\n'),o.push("[");let r=n.geojson.geometryColumn,s=!0,i=0;for await(const e of t){const t=i+(0,v.pg)(e);r||(r=r||gt(e));for(let n=i;n<t;++n)s||o.push(","),o.push("\n"),s=!1,xt(e,n,r,o),o.isFull()&&(yield o.getArrayBufferBatch()),i=t;const n=o.getArrayBufferBatch();n.byteLength>0&&(yield n)}o.push("\n"),o.push("]\n"),n.geojson.featureArray||o.push("}"),yield o.getArrayBufferBatch()}const At={id:"geojson",version:"latest",module:"geojson",name:"GeoJSON",extensions:["geojson"],mimeTypes:["application/geo+json"],text:!0,options:{geojson:{featureArray:!1,geometryColumn:null}},async encode(t,e){const n=bt([t],e);return await async function(t){const e=[];for await(const n of t)e.push(n);return function(...t){return function(t){const e=t.map((t=>t instanceof ArrayBuffer?new Uint8Array(t):t)),n=e.reduce(((t,e)=>t+e.byteLength),0),o=new Uint8Array(n);let r=0;for(const t of e)o.set(t,r),r+=t.byteLength;return o.buffer}(t)}(...e)}(n)},encodeInBatches:(t,e)=>bt(t,e)}},80991:(t,e,n)=>{function o(t,e="float32"){return t instanceof Date?"date-millisecond":t instanceof Number?e:"string"==typeof t?"utf8":"null"}function r(t){let e=function(t){switch(t.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}(t);return"null"!==e?{type:e,nullable:!1}:t.length>0?(e=o(t[0]),{type:e,nullable:!0}):{type:"null",nullable:!0}}function s(t,e){if(!e)switch(t){case"int8":return Int8Array;case"uint8":return Uint8Array;case"int16":return Int16Array;case"uint16":return Uint16Array;case"int32":return Int32Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array}return Array}n.d(e,{IT:()=>r,k1:()=>o,my:()=>s})},16458:(t,e,n)=>{n.d(e,{O:()=>r});var o=n(80991);function r(t){switch(t.shape){case"array-row-table":case"object-row-table":return function(t){if(!t.length)throw new Error("deduce from empty table");const e=[],n=t[0];for(const[t,o]of Object.entries(n))e.push(i(o,t));return{fields:e,metadata:{}}}(t.data);case"columnar-table":return function(t){const e=[];for(const[n,o]of Object.entries(t)){const t=s(o,n);e.push(t)}return{fields:e,metadata:{}}}(t.data);default:throw new Error("Deduce schema")}}function s(t,e){if(ArrayBuffer.isView(t)){const n=(0,o.IT)(t);return{name:e,type:n.type||"null",nullable:n.nullable}}if(Array.isArray(t)&&t.length>0){const n=t[0];return{name:e,type:(0,o.k1)(n),nullable:!0}}throw new Error("empty table")}function i(t,e){return{name:e,type:(0,o.k1)(t),nullable:!0}}}}]);